---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# EDCP: E-Detector-based online Change-Point detection algorithms

<!-- badges: start -->
[![R-CMD-check](https://github.com/shinjaehyeok/EDCP/workflows/R-CMD-check/badge.svg)](https://github.com/shinjaehyeok/EDCP/actions)
<!-- badges: end -->

EDCP is a R package built to run e-detector-based nonparametric online change-point detection algorithms in [CITE PAPER].

## Installation

You can install the development version of EDCP from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("shinjaehyeok/EDCP")
```

## Example

Suppose we have a stream of observations $X_1, X_2, \dots \in [0,1]$. Before an unknown change-point $\nu$, each pre-change observation has mean less than or equal to $0.2$. But after the chagne-point $\nu$, each post-change observation has mean larger than $0.2$.  

```{r example}
set.seed(1)
library(EDCP)
# Generate a stream of observations
# For simplicity, we use beta distributions to generate samples
max_sample <- 1000L
nu <- 500L
x_vec <- numeric(max_sample)
x_vec[1:nu] <- rbeta(nu, 1, 4)
x_vec[seq(nu+1, max_sample)] <- rbeta((max_sample - nu), 2, 3)
plot(1:max_sample, x_vec, pch=20, 
     xlab = "n", ylab = "X_n", main = "Simulated Data")
lines(x = c(0,nu), y = c(0.2,0.2), col = 2, lwd = 2)
lines(x = c(nu,max_sample), y = c(0.4,0.4), col = 2, lwd =2 )
```

Below, we compute a mixture e-detectors by which we can infer when the change of the mean happened.
```{r edcp}
m <- 0.2 # Upper bound of mean of pre-change observations
d <- 0.1  # Guess on the minimum gap between pre- and post-change means
E_fn_list <- generate_sub_E_fn()

# Compute parameters
base_param <- compute_baseline(
  alpha = 1e-3,
  delta_lower = m * d / (1/4 + (1-m)^2), # 0.0225
  delta_upper = m * (1-m) / d^2,  # 16
  psi_fn_list = generate_sub_E_fn(),
  v_min = 0,
  k_max = 1000
)

# Compute e-detectors
log_base_fn_list <- sapply(base_param$lambda, 
                           generate_log_bounded_base_fn,
                           m = 0.2)

# Compute mixture of SR-type e-detectors.
mix_SR <- update_log_mix_e_detectors(x_vec,
                                     base_param$omega,
                                     log_base_fn_list)

# Inferred change-point
mix_SR_stop <- min(
  which(mix_SR$log_mix_e_detect_val > base_param$g_alpha)
  )

# Plot 
plot(1:max_sample, mix_SR$log_mix_e_detect_val, type = "l",
     xlab = "n", ylab = "log e-detectors", main = paste0("v = ", nu, " v_hat = ",mix_SR_stop))
abline(h = base_param$g_alpha, col = 2)
abline(v = nu, col = 1, lty = 2)
abline(v = mix_SR_stop, col = 2, lty = 2)

```
```{r example2}
plot(1:max_sample, x_vec, pch=20, 
     xlab = "n", ylab = "X_n", main = "Simulated Data with the detected CP")
lines(x = c(0,nu), y = c(0.2,0.2), col = 2, lwd = 2)
lines(x = c(nu,max_sample), y = c(0.4,0.4), col = 2, lwd =2 )
abline(v = nu, col = 1, lty = 2)
abline(v = mix_SR_stop, col = 2, lty = 2, lwd = 2)
```
You'll still need to render `README.Rmd` regularly, to keep `README.md` up-to-date. `devtools::build_readme()` is handy for this. 
